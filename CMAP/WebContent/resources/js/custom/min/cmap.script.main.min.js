var scriptShowMaxLine=2,_SCRIPT_TYPE_="SCRIPT_TYPE";function showScriptContent(e,t){var a=new Object;a.scriptInfoId=e,a.type=t,$.ajax({url:_ctx+"/script/view",data:JSON.stringify(a),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",async:!0,success:function(e){"200"==e.code?($("#viewScriptModal_scriptName").val(e.data.script),$("#viewScriptModal_scriptContent").html(e.data.content),$("#viewScriptModal").modal("show")):alert(e.message)},error:function(e,t,a){ajaxErrorHandler()}})}function getPartialContent(e){var t="";if(null!=e&&""!=e){var a=e.split("<br>");if(a.length>scriptShowMaxLine){for(var r=0;r<scriptShowMaxLine;r++)t+=a[r],r!=scriptShowMaxLine-1&&(t+="<br>");t+='&nbsp;&nbsp;<a href="javascript:void(0);" >...(顯示)</a>'}else t=e}return t}function findData(e){$("#queryFrom").val(e),$("input[name=checkAll]").prop("checked",!1),"MOBILE"==e&&$("#collapseExample").collapse("hide"),"undefined"!=typeof resultTable?(resultTable.clear().draw(),resultTable.ajax.reload()):($(".myTableSection").show(),resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,pageLength:100,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},ajax:{url:_ctx+"/script/getScriptData.json",type:"POST",data:function(e){return"WEB"==$("#queryFrom").val()?e.queryScriptTypeCode=$("#queryScriptType").val():"MOBILE"==$("#queryFrom").val()&&(e.queryScriptTypeCode=$("#queryScriptType_mobile").val()),e},error:function(e,t,a){ajaxErrorHandler()}},order:[[3,"asc"]],initComplete:function(e,t){},drawCallback:function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),initCheckedItems(),bindTrEvent()},createdRow:function(e,t,a){0==t.enableModify&&$(e).children("td").eq(0).addClass("hide"),null!=t.actionScript&&($(e).children("td").eq(5).attr("onclick","javascript:showScriptContent('"+t.scriptInfoId+"', 'A');"),$(e).children("td").eq(5).addClass("cursor_zoom_in")),null!=t.checkScript&&($(e).children("td").eq(7).attr("onclick","javascript:showScriptContent('"+t.scriptInfoId+"', 'C');"),$(e).children("td").eq(7).addClass("cursor_zoom_in"))},columns:[{},{},{data:"scriptName"},{data:"scriptTypeName",className:"center"},{data:"deviceModel",className:"center"},{},{data:"actionScriptRemark"},{},{data:"checkScriptRemark"},{data:"createTimeStr",className:"center"},{data:"updateTimeStr",className:"center"}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,t,a){return'<input type="radio" id="radiobox" name="radiobox" onclick="resetTrBgColor();changeTrBgColor(this)" value='+a.scriptTypeId+">"}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,t,a,r){return r.row+r.settings._iDisplayStart+1}},{targets:[5],className:"left",searchable:!0,orderable:!0,render:function(e,t,a,r){return getPartialContent(a.actionScript)}},{targets:[7],className:"left",searchable:!0,orderable:!0,render:function(e,t,a,r){return getPartialContent(a.checkScript)}}]}))}function showPanel(){""!=$("#queryScriptType").val()?(window.sessionStorage.clear(),STEP_NUM=1,initStepBtn(),initStepImg(),$("#stepModal").modal({backdrop:"static"})):alert(msg_chooseType)}function initStepBtn(){switch(STEP_NUM){case 1:$("#btnStepGoPrev").hide(),$("#btnStepGoNext").show(),$("#btnStepGoFire").hide();break;case 2:$("#btnStepGoPrev").show(),$("#btnStepGoNext").show(),$("#btnStepGoFire").hide();break;case 3:$("#btnStepGoPrev").show(),$("#btnStepGoNext").hide(),$("#btnStepGoFire").show()}}function initStepImg(){var e=parseInt(STEP_NUM)-1;$(".step-img").removeClass("step-current"),$(".step-img").eq(e).addClass("step-current")}function goStep(e){var t=parseInt(STEP_NUM)+parseInt(e),a=parseInt(STEP_NUM);parseInt(t)>parseInt(a)&&($(".required").removeClass("required"),!checkB4Next(a))||($("#step"+t+"_section").show(),$("#step"+a+"_section").hide(),STEP_NUM=parseInt(STEP_NUM)+parseInt(e),initStepBtn(),initStepImg())}function checkB4Next(e){var t=[],a=[];switch(e){case 1:var r=$("input[name=input_var]"),n=$("textarea[name=input_var]"),i=!0;return r.length>0&&$.each(r,function(e,r){if(0==r.value.trim().length)i=!1,t.push(r);else{var n=$(r).data("idx");void 0===a[n]&&(a[n]=[]),a[n].push(r.value.trim())}}),n.length>0&&$.each(n,function(e,r){if(0==r.value.trim().length)i=!1,t.push(r);else{var n=$(r).data("idx");void 0===a[n]&&(a[n]=[]),a[n].push(r.value.trim());var s=r.value.trim().split(/\r?\n|\r/g);$.each(s,function(e,t){console.log("TEXTAREA word : "+t)})}console.log("TEXTAREA word : "+r.value.trim().length),console.log("TEXTAREA line : "+r.value.trim().match(/\r?\n|\r/g).length+1)}),i?(window.sessionStorage.setItem(_DELIVERY_VAR_VALUE_,JSON.stringify(a)),i):($.each(t,function(e,t){$(t).addClass("required")}),alert("請輸入變數值"),!1);case 2:$("#btnStepGoPrev").show(),$("#btnStepGoNext").show(),$("#btnStepGoFire").hide();break;case 3:$("#btnStepGoPrev").show(),$("#btnStepGoNext").hide(),$("#btnStepGoFire").show()}}$(document).ready(function(){initMenuStatus("toggleMenu_cm","toggleMenu_cm_items","cm_script"),$("#btnAdd").click(function(e){showPanel()}),$("#btnStepGoPrev").click(function(e){goStep(-1)}),$("#btnStepGoNext").click(function(e){e.preventDefault(),goStep(1)}),$("#btnStepGoFire").click(function(e){})});