var currentDiffPos=-1,diffPos=[],remarkShowLength=50;function changeCompareDesc(e){e?$("#compareModal_summary").html("共 "+diffPos.length+" 個差異；第 "+(currentDiffPos+1)+" 個差異點"):$("#compareModal_summary").html("共 "+diffPos.length+" 個差異")}function doDataExport(e){var a=new Object;"WEB"==$("#queryFrom").val()?(a.queryGroup1=$("#queryGroup1").val(),a.queryGroup2=$("#queryGroup2").val(),a.queryDevice1=$("#queryDevice1").val(),a.queryDevice2=$("#queryDevice2").val(),a.queryDateBegin1=$("#queryExcuteDateBegin1").val(),a.queryDateEnd1=$("#queryExcuteDateEnd1").val(),a.queryDateBegin2=$("#queryExcuteDateBegin2").val(),a.queryDateEnd2=$("#queryExcuteDateEnd2").val(),a.queryConfigType=$("#queryConfigType").val(),a.queryNewChkbox=!!$("#queryNewChkbox").prop("checked")):"MOBILE"==$("#queryFrom").val()&&(a.queryGroup1=$("#queryGroup1_mobile").val(),a.queryGroup2=$("#queryGroup2_mobile").val(),a.queryDevice1=$("#queryDevice1_mobile").val(),a.queryDevice2=$("#queryDevice2_mobile").val(),a.queryDateBegin1=$("#queryExcuteDateBegin1_mobile").val(),a.queryDateEnd1=$("#queryExcuteDateEnd1_mobile").val(),a.queryDateBegin2=$("#queryExcuteDateBegin2_mobile").val(),a.queryDateEnd2=$("#queryExcuteDateEnd2_mobile").val(),a.queryConfigType=$("#queryConfigType_mobile").val(),a.queryNewChkbox=!!$("#queryNewChkbox_mobile").prop("checked")),a.searchValue=$("#resultTable_filter").find("input").val(),a.exportRecordCount=e,$.ajax({url:_ctx+"/version/dataExport.json",data:a,type:"POST",dataType:"json",async:!0,beforeSend:function(e){showProcessing()},complete:function(){hideProcessing()},initComplete:function(e,a){},success:function(e){if(200==e.code){const a=e.data.fileId,r=getResourceDownloadLink(a);location.href=r,closeExportPanel()}else alert(e.message)},error:function(e,a,r){ajaxErrorHandler()}})}function compareFile(){var e=$("input[name=chkbox]:checked");if(e.length>2)alert("版本比對僅能勾選兩筆檔案進行，請重新選擇");else{for(var a,r=new Array,o=0;o<e.length;o++)(a=new Object).name="versionId",a.value=e[o].value,r.push(a);$.ajax({url:_ctx+"/version/compare",data:JSON.stringify(r),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",dataType:"json",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?($("#compareModal_contentLineNum").html(e.data.versionLineNum),$("#compareModal_contentLeft").html(e.data.contentLeft),$("#compareModal_contentRight").html(e.data.contentRight),$("#viewModal_versionLeft").val(e.data.versionLeft),$("#viewModal_versionRight").val(e.data.versionRight),currentDiffPos=0,""!=e.data.diffPos?(diffPos=e.data.diffPos.split(","),$("#compareModal_summary").html("共 "+diffPos.length+" 個差異")):$("#compareModal_summary").html("無差異"),$("#compareModal").modal("show")):alert(e.message)},error:function(e,a,r){ajaxErrorHandler()}})}}function deleteData(){0!=$("input[name=chkbox]:checked").length?confirm("確認刪除?","deleteDataGO"):alert("請選擇要刪除的項目")}function deleteDataGO(){for(var e,a=$("input[name=chkbox]:checked"),r=new Array,o=0;o<a.length;o++)(e=new Object).name="versionId",e.value=a[o].value,r.push(e);$.ajax({url:_ctx+"/version/delete",data:JSON.stringify(r),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",dataType:"json",async:!0,success:function(e){"200"==e.code&&(clearDialog(),alert(e.message),findData($("#queryFrom").val()))},error:function(e,a,r){ajaxErrorHandler()}})}function findData(e){$("#queryFrom").val(e),$("input[name=checkAll]").prop("checked",!1),"MOBILE"==e&&$("#collapseExample").collapse("hide"),"undefined"!=typeof resultTable?resultTable.ajax.reload():($(".myTableSection").show(),resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,pageLength:100,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,a,r){null!=a.deviceName&&a.deviceName.length>remarkShowLength&&($(e).children("td").eq(3).attr("onclick","javascript:changeShowContent(this, "+remarkShowLength+");"),$(e).children("td").eq(3).addClass("cursor_zoom_in")),$(e).children("td").eq(3).attr("content",a.deviceName)},ajax:{url:_ctx+"/version/getVersionInfoData.json",type:"POST",data:function(e){return"WEB"==$("#queryFrom").val()?(e.queryGroup1=$("#queryGroup1").val(),e.queryGroup2=$("#queryGroup2").val(),e.queryDevice1=$("#queryDevice1").val(),e.queryDevice2=$("#queryDevice2").val(),e.queryDateBegin1=$("#queryExcuteDateBegin1").val(),e.queryDateEnd1=$("#queryExcuteDateEnd1").val(),e.queryDateBegin2=$("#queryExcuteDateBegin2").val(),e.queryDateEnd2=$("#queryExcuteDateEnd2").val(),e.queryConfigType=$("#queryConfigType").val(),e.queryNewChkbox=!!$("#queryNewChkbox").prop("checked")):"MOBILE"==$("#queryFrom").val()&&(e.queryGroup1=$("#queryGroup1_mobile").val(),e.queryGroup2=$("#queryGroup2_mobile").val(),e.queryDevice1=$("#queryDevice1_mobile").val(),e.queryDevice2=$("#queryDevice2_mobile").val(),e.queryDateBegin1=$("#queryExcuteDateBegin1_mobile").val(),e.queryDateEnd1=$("#queryExcuteDateEnd1_mobile").val(),e.queryDateBegin2=$("#queryExcuteDateBegin2_mobile").val(),e.queryDateEnd2=$("#queryExcuteDateEnd2_mobile").val(),e.queryConfigType=$("#queryConfigType_mobile").val(),e.queryNewChkbox=!!$("#queryNewChkbox_mobile").prop("checked")),e},error:function(e,a,r){ajaxErrorHandler()}},initComplete:function(e,a){},drawCallback:function(e){$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),initCheckedItems(),bindTrEvent()},columns:[{},{},{data:"groupName"},{},{data:"deviceModel",className:"center"},{data:"configType"},{},{}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,a,r){return'<input type="checkbox" id="chkbox" name="chkbox" onclick="changeTrBgColor(this)" value='+r.versionId+">"}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,a,r,o){return o.row+o.settings._iDisplayStart+1}},{targets:[3],className:"left",searchable:!0,orderable:!0,render:function(e,a,r,o){return null!=r.deviceName&&r.deviceName.length>remarkShowLength?getPartialContentHtml(r.deviceName,remarkShowLength):r.deviceName}},{targets:[6],className:"left",searchable:!0,orderable:!0,render:function(e,a,r){return'<a href="#" onclick="viewConfig(\''+r.versionId+"')\">"+r.configVersion+"</a>"}},{targets:[7],className:"center",searchable:!1,orderable:!0,render:function(e,a,r){return r.backupTimeStr}}]}))}$(document).ready(function(){initMenuStatus("toggleMenu_cm","toggleMenu_cm_items","cm_manage"),changeDeviceMenu("queryDevice1",$("#queryGroup1").val()),changeDeviceMenu("queryDevice2",$("#queryGroup2").val()),$("#btnCompare").click(function(e){compareFile()}),$("#btnDelete").click(function(e){deleteData()});var e=$("div[id$='compareModal_contentLeft']").add($("div[id$='compareModal_contentRight']")).add($("div[id$='compareModal_contentLineNum']"));e.on("scroll",function(){e.scrollTop($(this).scrollTop())}),$("#compareModal_contentLineNum").scroll(function(){var e=$("#compareModal_contentLineNum").scrollTop(),a=$("#compareModal_contentLineNum").prop("offsetHeight"),r=$("#compareModal_contentLineNum").prop("scrollHeight");0==e?currentDiffPos=-1:e+a==r&&(currentDiffPos=diffPos.length)}),$("#compareModal").on("shown.bs.modal",function(){currentDiffPos=-1,setTimeout(function(){$("#compareModal_contentLineNum").scrollTop(0)},300)}),$("#jumpToTop").click(function(e){$(".diffPos").css("background-color",""),$("#compareModal_contentLineNum").animate({scrollTop:0},"500"),currentDiffPos=-1,$(".diffPos").removeClass("compare-current-pos"),changeCompareDesc(!1)}),$("#jumpToPre").click(function(e){currentDiffPos<=0?currentDiffPos=diffPos.length-1:currentDiffPos-=1,$("#compareModal_contentLineNum").animate({scrollTop:$(".diffPos")[currentDiffPos].offsetTop},"500"),$(".diffPos").removeClass("compare-current-pos"),$(".diffPos").eq(currentDiffPos).addClass("compare-current-pos"),changeCompareDesc(!0)}),$("#jumpToNext").click(function(e){currentDiffPos+1>=diffPos.length?currentDiffPos=0:currentDiffPos+=1,$("#compareModal_contentLineNum").animate({scrollTop:$(".diffPos")[currentDiffPos].offsetTop},"500"),$(".diffPos").removeClass("compare-current-pos"),$(".diffPos").eq(currentDiffPos).addClass("compare-current-pos"),changeCompareDesc(!0)}),$("#jumpToBottom").click(function(e){$(".diffPos").css("background-color","");var a=$("#compareModal_contentLineNum").prop("offsetHeight"),r=$("#compareModal_contentLineNum").prop("scrollHeight");$("#compareModal_contentLineNum").animate({scrollTop:r-a},"500"),$(".diffPos").removeClass("compare-current-pos"),changeCompareDesc(!1)})});