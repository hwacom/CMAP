var remarkShowLength=30;function initActionBar(){$("#modifyActionBar").hide(),$("#defaultActionBar").show(),$(".dataTable").find("thead").eq(0).find("tr > th").css("pointer-events","auto"),$("select[name=resutTable_length]").removeAttr("disabled"),$("input[type=search]").removeAttr("disabled")}function toggleActionBar(){$("#modifyActionBar").toggle(),$("#defaultActionBar").toggle()}function changeModifyView(){var e=$("input[name=chkbox]:checked");if(0!=e.length)if(e.length>1)alert("請僅勾選1個項目");else{for(var t=0;t<e.length;t++){document.getElementsByTagName("body")[0].innerText;if($("input[name=chkbox]:checked:eq("+t+")").attr("disabled","disabled"),$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(2).html(function(){return'<input type="text" name="modeifyAccount" value="'+$(this).text()+'" class="form-control form-control-sm" style="min-width: 100px" readonly/>'}),$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(3).html(function(){return'<input type="text" name="modifyUserName" value="'+$(this).text()+'" class="form-control form-control-sm" style="min-width: 150px"/>'}),$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(4).html(function(){return'<input type="password" name="modifyPassword" value="'+$(this).children().val()+'" class="form-control form-control-sm" style="min-width: 100px" />'}),$("#btnAdd").length){var n=0;$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(5).html(function(){for(var e='<select id="modifyUserGroup"  class="form-control form-control-sm" style="min-width: 120px">',a=document.getElementById("addUserGroup"),o=$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(1).text(),i=$("#resultTable").DataTable().columns([6]).data()[0][o-1],r=0,d=a.options.length;r<d;r++)e=e+'<option value="'+a.options[r].value+'" >'+a.options[r].text+"</option>",i===a.options[r].value&&(n=r);return e+="</select>"});var a=0;$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(6).html(function(){for(var e='<select id="modifyLoginMode"  class="form-control form-control-sm" style="min-width: 120px">',t=document.getElementById("addLoginMode"),n=0,o=t.options.length;n<o;n++)e=e+'<option value="'+t.options[n].value+'" >'+t.options[n].text+"</option>",$(this).text()===t.options[n].value&&(a=n);return e+="</select>"})}}$("#btnAdd").length&&(document.getElementById("modifyUserGroup").options[n].selected=!0,document.getElementById("modifyLoginMode").options[a].selected=!0),toggleActionBar(),$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$(".dataTable").find("thead").eq(0).find("tr > th").removeClass("sorting sorting_asc sorting_desc"),$(".dataTable").find("thead").eq(0).find("tr > th").css("pointer-events","none"),$("select[name=resutTable_length]").attr("disabled","disabled"),$("input[type=search]").attr("disabled","disabled"),$("li[id^=resutTable_]").addClass("disabled")}else alert("請先勾選欲修改的項目")}function envAction(e){var t=new Object,n=$("input[name='chkbox']:checked").map(function(){return $(this).val()}).get();if(t.id=n,"modify"==e){var a=$("input[name='modeifyAccount']").map(function(){return $(this).val()}).get(),o=$("input[name='modifyUserName']").map(function(){return $(this).val()}).get(),i=$("input[name='modifyPassword']").map(function(){return $(this).val()}).get();if($("#modifyUserGroup").length)var r=$("#modifyUserGroup :selected").map(function(){return $(this).val()}).get();else r=null;if($("#modifyLoginMode").length)var d=$("#modifyLoginMode :selected").map(function(){return $(this).val()}).get();else d=null;var l=null;t.modeifyAccount=a,t.modifyUserName=o,t.modifyPassword=i,t.modifyUserGroup=r,t.modifyLoginMode=d,t.addIsAdmin=l,doActionAjax(t,"save")}else if("delete"==e){if(0==$("input[name=chkbox]:checked").length)return void alert("請先勾選欲刪除的項目");confirm("請確認是否刪除","doDeleteActionAjax")}else if("add"==e){for(var s=document.getElementsByClassName("checkRequired"),c=0;c<s.length;c++){var u=s[c].value;if(!u||/^\s*$/.test(u))return void alert(s[c].placeholder+"不可為空白")}a=$("input[name='addAccount']").map(function(){return $(this).val()}).get(),o=$("input[name='addUserName']").map(function(){return $(this).val()}).get(),i=$("input[name='addPassword']").map(function(){return $(this).val()}).get(),r=$("#addUserGroup :selected").map(function(){return $(this).val()}).get(),d=$("#addLoginMode :selected").map(function(){return $(this).val()}).get(),l=$("#addIsAdmin :selected").map(function(){return $(this).val()}).get();t.modeifyAccount=a,t.modifyUserName=o,t.modifyPassword=i,t.modifyUserGroup=r,t.modifyLoginMode=d,t.addIsAdmin=l,doActionAjax(t,"save")}}function doDeleteActionAjax(){var e=new Object,t=$("input[name='chkbox']:checked").map(function(){return $(this).val()}).get();e.ids=t,doActionAjax(e,"delete")}function doActionAjax(e,t){$.ajax({url:_ctx+"/userRight/"+t,data:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",dataType:"json",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(t){"200"==t.code?(alert(t.message),findData($("#queryFrom").val()),null!=e.addIsAdmin&&setTimeout(function(){$("#addModifyModal").modal("hide")},500)):(alert("envAction > success > else :: resp.code: "+t.code),alert(t.message))},error:function(e,t,n){ajaxErrorHandler()}})}function findData(e){$("#queryFrom").val(e),$("input[name=checkAll]").prop("checked",!1),"MOBILE"==e&&$("#collapseExample").collapse("hide"),initActionBar(),"undefined"!=typeof resultTable?resultTable.ajax.reload():resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!1,bFilter:!1,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight-20,scrollCollapse:!0,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},ajax:{url:_ctx+"/userRight/getEnvConfig.json",type:"POST",data:function(e){},dataSrc:function(e){return $("#diffMsg").text(e.msg),e.data},error:function(e,t,n){ajaxErrorHandler()}},order:[[2,"asc"]],initComplete:function(e,t){},drawCallback:function(e){resultTable.columns([6]).visible(!1),$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),bindTrEvent()},columns:[{},{},{data:"account"},{data:"userName"},{data:"password"},{data:"userGroupStr"},{data:"userGroup",className:"hiddenColumn"},{data:"loginMode"},{data:"isAdmin",className:"center"},{data:"createTimeStr"},{data:"createBy"},{data:"updateTimeStr"},{data:"updateBy"}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,t,n){return'<input type="checkbox" id="chkbox" name="chkbox" onclick="changeTrBgColor(this)" value="'+n.id+'">'}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,t,n,a){return a.row+a.settings._iDisplayStart+1}},{targets:[4],className:"center",searchable:!1,orderable:!1,render:function(e,t,n,a){return'<input type="password" value="'+n.password+'" style="max-width: 70px" readonly="readonly">'}}]})}$(document).ready(function(){initMenuStatus("toggleMenu_admin","toggleMenu_admin_items","bk_usr"),isWEB?findData("WEB"):findData("MOBILE"),$("#btnAdd").click(function(){uncheckAll(),initModal(),$("#addModifyModal").modal({backdrop:"static"})}),$("#btnModify").click(function(){changeModifyView()}),$("#btnDelete").click(function(){envAction("delete")}),$("#btnModifySubmit").click(function(){envAction("modify")}),$("#btnModifyCancel").click(function(){findData($("#queryFrom").val())}),$("#btnSave").click(function(){envAction("add")})});