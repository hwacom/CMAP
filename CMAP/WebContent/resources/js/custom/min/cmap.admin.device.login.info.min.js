var remarkShowLength=30;function chkChecked(){var e=0;return $("input[type=checkbox][name=chkbox]").each(function(){if(this.checked)return e++,!1}),e}function toggleActionBar(){$("#modifyActionBar").toggle(),$("#defaultActionBar").toggle()}function envAction(e){if("modify"==e){var a=new Object,t=$("input[name='chkbox']:checked").map(function(){return $(this).val()}).get();if($("#modifyConnectionMode").length)var n=$("#modifyConnectionMode :selected").map(function(){return $(this).val()}).get();var o=$("input[name='modifyLoginAccount']").map(function(){return $(this).val()}).get(),r=$("input[name='modifyLoginPassword']").map(function(){return $(this).val()}).get(),i=$("input[name='modifyEnablePassword']").map(function(){return $(this).val()}).get();if($("#modifyEnableBackup").length)var c=$("#modifyEnableBackup :selected").map(function(){return $(this).val()}).get();a.ids=t,a.modifyConnectionMode=n,a.modifyLoginAccount=o,a.modifyLoginPassword=r,a.modifyEnablePassword=i,a.modifyEnableBackup=c,doActionAjax(a,"save")}else if("delete"==e){if(0==$("input[name=chkbox]:checked").length)return void alert("請先勾選欲刪除的項目");confirm("請確認是否刪除","doDeleteActionAjax")}}function doDeleteActionAjax(){var e=new Object,a=$("input[name='chkbox']:checked").map(function(){return $(this).val()}).get();e.ids=a,doActionAjax(e,"delete")}function doActionAjax(e,a){$.ajax({url:_ctx+"/deviceLoginInfo/"+a,data:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",dataType:"json",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?(setTimeout(function(){$("#modifyModal").modal("hide")},500),alert(e.message),findData($("#queryFrom").val())):(alert("envAction > success > else :: resp.code: "+e.code),alert(e.message))},error:function(e,a,t){ajaxErrorHandler()}})}function findData(e){$("#queryFrom").val(e),$("input[name=checkAll]").prop("checked",!1),"MOBILE"==e&&$("#collapseExample").collapse("hide"),"undefined"!=typeof resultTable?resultTable.ajax.reload():resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight-20,scrollCollapse:!0,pageLength:100,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},ajax:{url:_ctx+"/deviceLoginInfo/getDeviceLoginInfo",type:"POST",data:function(e){return"WEB"==$("#queryFrom").val()?(e.queryGroup=$("#queryGroup").val(),e.queryDevice=$("#queryDevice").val()):"MOBILE"==$("#queryFrom").val()&&(e.queryGroup=$("#queryGroup_mobile").val(),e.queryDevice=$("#queryDevice_mobile").val()),e},dataSrc:function(e){return $("#diffMsg").text(e.msg),e.data},error:function(e,a,t){ajaxErrorHandler()}},order:[[2,"asc"]],initComplete:function(e,a){},drawCallback:function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),bindTrEvent()},columns:[{},{},{data:"remark",searchable:!0},{data:"connectionMode",searchable:!1},{data:"loginAccount",searchable:!1},{data:"loginPassword",searchable:!1},{data:"enablePassword",searchable:!1},{data:"enableBackup",searchable:!1},{data:"communityString",searchable:!1},{data:"udpPort",searchable:!1,className:"right"},{data:"updateTimeStr"},{data:"updateBy"}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,a,t){return'<input type="checkbox" id="chkbox" name="chkbox" onclick="changeTrBgColor(this)" value="'+t.deviceId+'">'}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,a,t,n){return n.row+n.settings._iDisplayStart+1}},{targets:[4],className:"center",searchable:!1,orderable:!1,render:function(e,a,t,n){return atob(t.loginAccount)}},{targets:[5],className:"center",searchable:!1,orderable:!1,render:function(e,a,t,n){return'<input type="password" value="'+t.loginPassword+'" style="max-width: 50px" readonly="readonly">'}},{targets:[6],className:"center",searchable:!1,orderable:!1,render:function(e,a,t,n){return'<input type="password" value="'+t.enablePassword+'" style="max-width: 50px" readonly="readonly">'}}]})}$(document).ready(function(){initMenuStatus("toggleMenu_admin","toggleMenu_admin_items","bk_deviceLoginInfo"),$("#btnModify").click(function(){var e=chkChecked();if(e){initModal();var a=$("input[name=chkbox]:checked").map(function(){return $(this).parents("tr").children().eq(2).text()}).get();document.getElementById("modifyRemark").value=a,document.getElementById("modifyRemark").disabled="disabled";var t=$("input[name=chkbox]:checked").map(function(){return $(this).val()}).get();document.getElementById("modifyIds").value=t,1==e&&(document.getElementById("modifyConnectionMode").value=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(3).text(),document.getElementById("modifyLoginAccount").value=atob($("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(4).text()),document.getElementById("modifyLoginPassword").value=atob($("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(5).children().eq(0).val()),document.getElementById("modifyEnablePassword").value=atob($("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(6).children().eq(0).val()),document.getElementById("modifyEnableBackup").value=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(7).text()),$("#modifyModal").modal({backdrop:"static"})}else alert("請勾選要修改的設備")}),$("#btnDelete").click(function(){envAction("delete")}),$("#btnSave").click(function(){envAction("modify")})});