var startNum,pageLength,isModify=!1;function envAction(e){var t=new Object,a=$("input[name='chkbox']:checked").map(function(){return $(this).val()}).get(0);if(t.deviceId=a,"delete"==e){if(0==$("input[name=chkbox]:checked").length)return void alert("請先勾選欲刪除的項目");confirm("請確認是否刪除","doDeleteActionAjax")}else if("save"==e){for(var n=document.getElementsByClassName("checkRequired"),r=0;r<n.length;r++){var l=n[r].value;if(!l||/^\s*$/.test(l))return void alert(n[r].placeholder+"不可為空白")}var o=$("input[name='inputAddProbe']").map(function(){return $(this).val()}).get(0),i="";$("input[name='inputAddGroup']").map(function(){""!=$(this).val().trim()&&(""!=i&&(i+=" > "),i+=$(this).val())});var d=$("input[name='inputAddDeviceName']").map(function(){return $(this).val()}).get(0),c=$("input[name='inputAddDeviceIp']").map(function(){return $(this).val()}).get(0),u=$("input[name='inputAddDeviceType']").map(function(){return $(this).val()}).get(0),s=$("input[name='inputAddBrand']").map(function(){return $(this).val()}).get(0),p=$("input[name='inputAddModel']").map(function(){return $(this).val()}).get(0),m=$("input[name='inputAddSystemVersion']").map(function(){return $(this).val()}).get(0),v=$("input[name='inputAddSerialNumber']").map(function(){return $(this).val()}).get(0),h=$("input[name='inputAddManufactureDate']").map(function(){return $(this).val()}).get(0),f=$("input[name='inputAddRemark']").map(function(){return $(this).val()}).get(0);t.modifyProbe=o,t.modifyGroup=i,t.modifyDeviceName=d,t.modifyDeviceIp=c,t.modifyDeviceType=u,t.modifyBrand=s,t.modifyModel=p,t.modifySystemVersion=m,t.modifySerialNumber=v,t.modifyManufactureDate=h,t.remark=f,doActionAjax(t,"save")}}function doDeleteActionAjax(){var e=new Object,t=$("input[name='chkbox']:checked").map(function(){return $(this).val()}).get();e.ids=t,doActionAjax(e,"delete")}function doActionAjax(e,t){$.ajax({url:_ctx+"/admin/inventory/"+t,data:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",dataType:"json",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?(setTimeout(function(){$("#addModifyModal").modal("hide")},500),alert(e.message),findData($("#queryFrom").val())):(alert("envAction > success > else :: resp.code: "+e.code),alert(e.message))},error:function(e,t,a){ajaxErrorHandler()}})}function findData(e){$("#queryFrom").val(e),"MOBILE"==e&&$("#collapseExample").collapse("hide"),startNum=0,"undefined"!=typeof resultTable?($(".dataTables_scrollBody").scrollTop(0),resultTable.ajax.reload(),$(".myTableSection").show()):($(".myTableSection").show(),resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!1,bFilter:!1,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,pageLength:pageLength,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,t,a){},ajax:{url:_ctx+"/admin/inventory/getInventoryInfoData.json",type:"POST",data:function(e){return"WEB"==$("#queryFrom").val()?(e.queryGroup=$("#queryGroup").val(),e.queryDevice=$("#queryDevice").val()):"MOBILE"==$("#queryFrom").val()&&(e.queryGroup=$("#queryGroup_mobile").val(),e.queryDevice=$("#queryDevice_mobile").val()),e.queryProbe=$("#queryProbe").val(),e.queryDeviceName=$("#queryDeviceName").val(),e.queryDeviceType=$("#queryDeviceType").val(),e.queryModifyOnly=document.getElementById("queryModifyOnly").checked,e.queryBrand=$("#queryBrand").val(),e.queryModel=$("#queryModel").val(),e.queryGroupName=$("#queryGroupName").val(),e.start=0,e.length=pageLength,e},beforeSend:function(){countDown("START")},complete:function(){countDown("STOP")},error:function(e,t,a){ajaxErrorHandler()},timeout:1e3*parseInt(_timeout)},order:[[6,"acs"]],initComplete:function(e,t){null!=t.msg&&($(".myTableSection").hide(),alert(t.msg)),bindScrollEvent()},drawCallback:function(e){$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),startNum=pageLength,lastScrollYPos=$(".dataTables_scrollBody").prop("scrollTop"),$("#resultTable_filter").find("input").prop("placeholder","(模糊查詢速度較慢)"),bindTrEvent()},columns:[{},{},{data:"deviceId",orderable:!1},{data:"probe",orderable:!1},{data:"groupName",orderable:!1},{data:"deviceName",orderable:!1},{data:"deviceIp",orderable:!1},{data:"deviceType",orderable:!1},{data:"brand",orderable:!1},{data:"model",orderable:!1},{data:"systemVersion",orderable:!1},{data:"serialNumber",orderable:!1},{data:"manufactureDate",orderable:!1}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,t,a){return'<input type="checkbox" id="chkbox" name="chkbox" onclick="changeTrBgColor(this)" value="'+a.deviceId+'">'}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,t,a,n){return n.row+n.settings._iDisplayStart+1}},{targets:[5],className:"left",searchable:!0,orderable:!0,render:function(e,t,a){return'<a href="#" onclick="viewCellDetail(\''+a.deviceId+"')\">"+a.deviceName+"</a>"}}]}))}function countDown(e){if("START"==e)startTime=parseInt(_timeout)-1,timer_start=performance.now(),timer=setInterval(function(){$("#timeoutMsg").val("Timeout倒數 : "+startTime+" 秒"),startTime--},1e3);else{timer_end=performance.now();var t=(parseInt(timer_end)-parseInt(timer_start))/1e3;$("#timeoutMsg").val("查詢花費時間 : "+t+" 秒"),clearInterval(timer)}}function bindScrollEvent(){$(".dataTables_scrollBody").scroll(function(e){if(0==$(".dataTables_empty").length){var t=$("#resultTable > tBody > tr").length,a=$(this).prop("scrollTop"),n=$(this).prop("scrollHeight")-$(this).prop("clientHeight");a>lastScrollYPos&&(lastScrollYPos=a,t>=pageLength&&a>=n-100&&(waitForNextData||(waitForNextData=!0,findNextData())))}})}function doDataExport(e){var t=new Object;"WEB"==$("#queryFrom").val()?(t.queryGroup=$("#queryGroup").val(),t.queryDevice=$("#queryDevice").val()):"MOBILE"==$("#queryFrom").val()&&(t.queryGroup=$("#queryGroup_mobile").val(),t.queryDevice=$("#queryDevice_mobile").val()),t.queryProbe=$("#queryProbe").val(),t.queryDeviceName=$("#queryDeviceName").val(),t.queryDeviceType=$("#queryDeviceType").val(),t.queryModifyOnly=document.getElementById("queryModifyOnly").checked,t.queryBrand=$("#queryBrand").val(),t.queryModel=$("#queryModel").val(),t.queryGroupName=$("#queryGroupName").val(),t.start=0,t.length=pageLength,t.exportRecordCount=e,$.ajax({url:_ctx+"/admin/inventory/dataExport.json",data:t,type:"POST",dataType:"json",async:!0,beforeSend:function(e){showProcessing()},complete:function(){hideProcessing()},initComplete:function(e,t){},success:function(e){if(200==e.code){const t=e.data.fileId,a=getResourceDownloadLink(t);location.href=a,closeExportPanel()}else alert(e.message)},error:function(e,t,a){ajaxErrorHandler()}})}function checkData(e){if(e.name.endsWith(".csv")){var t=new FileReader;t.readAsText(e,"big5"),t.onload=(e=>{var t=e.target.result;t.match(/\r?\n|\r/g).length<2?alert("檔案內容無資料資訊，請重新選擇"):$('<div class="confirm font" />').html("請確認是否匯入").dialog({title:"確認訊息",modal:!0,show:{effect:"fadeIn",duration:300},resizable:!1,open:function(){$(".ui-dialog").css("z-index",2e3),$(".ui-widget-overlay").css("z-index",1999),$(".ui-button.ui-corner-all.ui-widget.ui-button-icon-only.ui-dialog-titlebar-close").hide(),$(".ui-button.ui-corner-all.ui-widget").css("font-family","微軟正黑體")},buttons:{"確認":function(){$(this).dialog("close"),importData(t)},"取消":function(){$(this).dialog("close")}}})})}else alert("請選擇csv類型檔案")}function importData(e){var t=csvJSON(e);t.length<1?alert("檔案內容無資料資訊或資料格式錯誤，請重新選擇"):$.ajax({url:_ctx+"/admin/inventory/importData",data:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",dataType:"json",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?($("#importFileName").val(""),setTimeout(function(){$("#inventoryDataImportModal").modal("hide")},500),alert(e.message),findData($("#queryFrom").val())):(alert("envAction > success > else :: resp.code: "+e.code),alert(e.message))},error:function(e,t,a){ajaxErrorHandler()}})}function csvJSON(e){for(var t=e.split(/\r\n|\r|\n/),a=[],n=["probe","groupName","groupName2","groupName3","groupName4","groupName5","deviceName","deviceIp","deviceType","brand","model","systemVersion","serialNumber","manufactureDate","remark"],r=1;r<=t.length;r++){var l={};if(null!=t[r]&&t[r].indexOf(",")>-1){var o=t[r].split(",");if(o.length==n.length){for(var i="",d=0;d<n.length;d++)d>0&&d<=5?(""!=o[d].trim()&&(""!=i&&(i+=" > "),i+=o[d].trim()),5==d&&(l[n[1]]=i)):l[n[d]]=o[d];a.push(l)}}}return a}function divAddInputText(e){if(5!=$("input[name='inputAddGroup']").length){var t=document.createElement("input");t.setAttribute("type","text"),t.setAttribute("name","inputAddGroup"),t.setAttribute("class","form-control form-control-sm"),t.setAttribute("value",e),t.setAttribute("onchange","showValue()"),document.getElementById("inputAddGroupDiv").appendChild(t)}}function showValue(){var e="";$("input[name='inputAddGroup']").map(function(){""!=$(this).val().trim()&&(""!=e&&(e+=" > "),e+=$(this).val())}),$("#showGroupName").text(e),console.log("value = "+e)}function viewCellDetail(e){var t=new Object;t.deviceId=e,$.ajax({url:_ctx+"/admin/inventory/getInvCellDetailData.json",data:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?($("#viewCellDetailModal_frequencyBand").parent().show(),$("#viewCellDetailModal_amfIpAddress").parent().show(),$("#viewCellDetailModal_enodebType").parent().show(),$("#viewCellDetailModal_gnbId").parent().show(),$("#viewCellDetailModal_cellIdentify").parent().show(),$("#viewCellDetailModal_physicalCellGroupId").parent().show(),$("#viewCellDetailModal_physicalCellId").parent().show(),$("#viewCellDetailModal_plmn").parent().show(),$("#viewCellDetailModal_arfcn").parent().show(),$("#viewCellDetailModal_bandWidth").parent().show(),$("#viewCellDetailModal_currentTxPower").parent().show(),$("#viewCellDetailModal_frequencyBand").html(e.data.frequencyBand),$("#viewCellDetailModal_amfIpAddress").html(e.data.amfIpAddress),$("#viewCellDetailModal_enodebType").html(e.data.enodebType),$("#viewCellDetailModal_gnbId").html(e.data.gnbId),$("#viewCellDetailModal_cellIdentify").html(e.data.cellIdentify),$("#viewCellDetailModal_physicalCellGroupId").html(e.data.physicalCellGroupId),$("#viewCellDetailModal_physicalCellId").html(e.data.physicalCellId),$("#viewCellDetailModal_plmn").html(e.data.plmn),$("#viewCellDetailModal_arfcn").html(e.data.arfcn),$("#viewCellDetailModal_bandWidth").html(e.data.bandWidth),$("#viewCellDetailModal_currentTxPower").html(e.data.currentTxPower),$("#viewCellDetailModal").modal("show")):alert(e.message)},error:function(e,t,a){ajaxErrorHandler()}})}$(document).ready(function(){initMenuStatus("toggleMenu_admin","toggleMenu_admin_items","bk_inventory"),startNum=0,pageLength=Number($("#pageLength").val()),$("#btnAdd").click(function(){uncheckAll(),initModal(),$("#addModifyModal").modal({backdrop:"static"})}),$("#btnImport_web").click(function(){uncheckAll(),initModal(),$("#inventoryDataImportModal").modal({backdrop:"static"})}),$("#btnModify").click(function(){var e=$("input[name=chkbox]:checked");if(0!=e.length)if(e.length>1)alert("請僅勾選1個項目");else{if(document.getElementById("addProbe").value=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(3).text(),$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(4).text().indexOf(" > ")>-1){var t=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(4).text().split(" > ");document.getElementById("addGroup").value=t[0];for(var a=1;a<t.length;a++)divAddInputText(t[a])}else document.getElementById("addGroup").value=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(4).text();showValue(),document.getElementById("addDeviceName").value=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(5).text(),document.getElementById("addDeviceIp").value=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(6).text(),document.getElementById("addDeviceType").value=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(7).text(),document.getElementById("addBrand").value=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(8).text(),document.getElementById("addModel").value=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(9).text(),document.getElementById("addSystemVersion").value=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(10).text(),document.getElementById("addSerialNumber").value=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(11).text(),document.getElementById("addManufactureDate").value=$("input[name=chkbox]:checked:eq(0)").parents("tr").children().eq(12).text(),$("#addModifyModal").modal({backdrop:"static"})}else alert("請先勾選欲修改的項目")}),$("#btnDelete").click(function(){envAction("delete")}),$("#btnSave").click(function(){envAction("save")})});