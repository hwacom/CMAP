var resultTable,remarkShowLength=80;function resetTrBgColor(){$("tbody > tr").removeClass("mySelected")}function showRestorePanel(){var e=$("[type=radio]:checked").val();null==e||null!=e&&0==e.trim().length?alert("請先選擇要還原的設備"):$.ajax({url:_ctx+"/version/getVersionRecords.json",data:{deviceListId:e},type:"POST",dataType:"json",async:!0,beforeSend:function(){},complete:function(){},success:function(e){if("200"==e.code){$("#viewScriptModal_versionSelect option").remove();var a=e.data.versionList,t=1;$.each(a,function(e,a){$("#viewScriptModal_versionSelect").append($("<option></option>").attr("value",a.deviceListId+"@~"+a.versionId).text("("+t+") "+a.configVersion)),t++}),$("#viewVersionModal").modal("show")}else alert(e.message)},error:function(e,a,t){ajaxErrorHandler()}})}function doRestore(){var e=$("#viewScriptModal_versionSelect").val();null==e||null!=e&&0==e.trim().length?alert("請先選擇要還原的版本號"):confirm("按下確認後版本將立即還原且生效，請確認是否執行?","doRestoreGo")}function doRestoreGo(){var e=$("#viewScriptModal_versionSelect").val();if(null==e||null!=e&&0==e.trim().length)alert("請先選擇要還原的版本號");else{var a=e.split("@~")[0],t=e.split("@~")[1];$.ajax({url:_ctx+"/version/restore/execute",data:{deviceListId:a,versionId:t},type:"POST",dataType:"json",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?(alert(e.message),$("#viewVersionModal").modal("hide")):alert(e.message)},error:function(e,a,t){ajaxErrorHandler()}})}}function chkChecked(){var e=!1;return $("input[type=checkbox][name=chkbox]").each(function(){if(this.checked)return e=!0,!1}),e}function pressViewConfig(){var e=$("#viewScriptModal_versionSelect").val();if(null==e||null!=e&&0==e.trim().length)alert("請先選擇要預覽的版本號");else{var a=e.split("@~")[1];viewConfig(a)}}function findData(e){$("#queryFrom").val(e),$("input[name=checkAll]").prop("checked",!1),"MOBILE"==e&&$("#collapseExample").collapse("hide"),void 0!==resultTable?resultTable.ajax.reload():($(".myTableSection").show(),resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,pageLength:100,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,a,t){null!=a.deviceName&&a.deviceName.length>remarkShowLength&&($(e).children("td").eq(3).attr("onclick","javascript:changeShowContent(this, "+remarkShowLength+");"),$(e).children("td").eq(3).addClass("cursor_zoom_in")),$(e).children("td").eq(3).attr("content",a.deviceName)},ajax:{url:_ctx+"/version/getDeviceListData.json",type:"POST",data:function(e){return"WEB"==$("#queryFrom").val()?(e.queryGroup=$("#queryGroup").val(),e.queryDevice=$("#queryDevice").val()):"MOBILE"==$("#queryFrom").val()&&(e.queryGroup=$("#queryGroup_mobile").val(),e.queryDevice=$("#queryDevice_mobile").val()),e},error:function(e,a,t){ajaxErrorHandler()}},initComplete:function(e,a){},drawCallback:function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),initCheckedItems(),bindTrEvent()},columns:[{},{},{data:"groupName"},{},{data:"deviceModel",className:"center"}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,a,t){return'<input type="radio" id="chkbox" name="chkbox" onclick="changeTrBgColor(this)" value='+t.deviceId+">"}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,a,t,r){return r.row+r.settings._iDisplayStart+1}},{targets:[3],className:"left",searchable:!0,orderable:!0,render:function(e,a,t,r){return null!=t.deviceName&&t.deviceName.length>remarkShowLength?getPartialContentHtml(t.deviceName,remarkShowLength):t.deviceName}}]}))}$(document).ready(function(){initMenuStatus("toggleMenu_cm","toggleMenu_cm_items","cm_restore"),changeDeviceMenu("queryDevice",$("#queryGroup").val()),$("#btnSearch_web").click(function(e){findData("WEB")}),$("#btnSearch_mobile").click(function(e){findData("MOBILE")}),$("#btnRestore").click(function(e){showRestorePanel()}),$("#btnRestoreCancel").click(function(e){$("#viewVersionModal").modal("hide")}),$("#btnRestoreConfirm").click(function(e){doRestore()})});