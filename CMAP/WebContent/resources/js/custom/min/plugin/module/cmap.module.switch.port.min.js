var resultTable_blockedPortRecord,blockedPortTableHeight,blockReasonShowLength=30,openReasonShowLength=30,_navAndMenuAndFooterHeight=0,_deductHeight=0;function checkboxOnChangeEvent(){$("input[name=chkbox]").change(function(e){$("input[name=chkbox]:checked").length>0?$("#btnPortOpen").attr("disabled",!1):$("#btnPortOpen").attr("disabled",!0)})}function calBlockedPortSectionHeight(){_navAndMenuAndFooterHeight=0,_deductHeight=0,_navAndMenuAndFooterHeight="none"!=$(".mobile-menu").css("display")&&null!=$(".mobile-menu").css("display")?$(".navbar").outerHeight()+$(".footer").outerHeight()+$(".mobile-menu").outerHeight():$(".navbar").outerHeight()+$(".footer").outerHeight(),"none"!=$(".search-bar-large").css("display")&&null!=$(".search-bar-large").css("display")?(_navAndMenuAndFooterHeight+=$(".search-bar-large").outerHeight(),_deductHeight=110):_deductHeight=210,"none"!=$(".mainTable").css("display")&&null!=$(".mainTable").css("display")&&(_deductHeight+=$(".mainTable").outerHeight()),"none"!=$("#divBlockedTitle").css("display")&&null!=$("#divBlockedTitle").css("display")&&(_deductHeight+=$("#divBlockedTitle").outerHeight()),blockedPortTableHeight=(blockedPortTableHeight=Math.round(window.innerHeight-_navAndMenuAndFooterHeight-_deductHeight))<165?165:blockedPortTableHeight}function doConfirmPortOpenByBtn(){confirm("按下確認後將立即執行Port開通作業，請再次確認是否執行?")&&doPortOpenByBtn()}function doPortOpenByBtn(){for(var e=new Array,t=$("input[name=chkbox]:checked"),a=0;a<t.length;a++)e.push(t[a].value);$.ajax({url:_ctx+"/delivery/doPortOpenByBtn.json",data:{listId:e},type:"POST",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?(alert(e.message),setTimeout(function(){$("#stepModal").modal("hide")},500)):alert(e.message)},error:function(e,t,a){ajaxErrorHandler()}})}function findBlockedPortRecordData(e){calBlockedPortSectionHeight(),void 0!==resultTable_blockedPortRecord?resultTable_blockedPortRecord.ajax.reload():($("#divBlockedPortRecord").show(),resultTable_blockedPortRecord=$("#resultTable_blockedPortRecord").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:blockedPortTableHeight,scrollCollapse:!0,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,t,a){null!=t.blockReason&&t.blockReason.length>blockReasonShowLength&&($(e).children("td").eq(7).attr("onclick","javascript:showFullScript($(this));"),$(e).children("td").eq(7).addClass("cursor_zoom_in")),$(e).children("td").eq(7).attr("content",t.blockReason),null!=t.openReason&&t.openReason.length>openReasonShowLength&&($(e).children("td").eq(10).attr("onclick","javascript:showFullScript($(this));"),$(e).children("td").eq(10).addClass("cursor_zoom_in")),$(e).children("td").eq(10).attr("content",t.openReason)},ajax:{url:_ctx+"/delivery/getBlockedPortData.json",type:"POST",data:function(t){return"WEB"==$("#queryFrom").val()?(t.queryGroupId=$("#queryGroup").val(),t.queryDeviceId=$("#queryDevice").val()):"MOBILE"==$("#queryFrom").val()&&(t.queryGroupId=$("#queryGroup_mobile").val(),t.queryDeviceId=$("#queryDevice_mobile").val()),"B"==e&&(t.queryStatusFlag=e),t},error:function(e,t,a){ajaxErrorHandler()}},order:[[6,"desc"]],pageLength:100,drawCallback:function(e){$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),bindTrEventOnlyCheckbox(),checkboxOnChangeEvent();var t=window.location.pathname,a=t.substring(t.lastIndexOf("/"),t.length);"/switchPort"===a?($('[data-field="status"]').hide(),$('[data-field="openTime"]').hide(),$('[data-field="openReason"]').hide(),$('[data-field="openBy"]').hide()):"/portBlocked"===a&&$('[data-field="action"]').hide(),$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()},rowCallback:function(e,t){$("td:eq(0)",e).attr("data-field","action"),$("td:eq(1)",e).attr("data-field","seq"),$("td:eq(2)",e).attr("data-field","groupName"),$("td:eq(3)",e).attr("data-field","deviceName"),$("td:eq(4)",e).attr("data-field","portName"),$("td:eq(5)",e).attr("data-field","status"),$("td:eq(6)",e).attr("data-field","blockTime"),$("td:eq(7)",e).attr("data-field","blockReason"),$("td:eq(8)",e).attr("data-field","blockBy"),$("td:eq(9)",e).attr("data-field","openTime"),$("td:eq(10)",e).attr("data-field","openReason"),$("td:eq(11)",e).attr("data-field","openBy")},columns:[{},{},{data:"groupName",className:"left"},{data:"deviceName",className:"left"},{data:"portName",className:"center"},{data:"statusFlag",className:"center"},{data:"blockTimeStr",className:"center"},{},{data:"blockBy",className:"center"},{data:"openTimeStr",className:"center"},{},{data:"openBy",className:"center"}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,t,a){return'<input type="checkbox" id="chkbox" name="chkbox" onclick="changeTrBgColor(this)" value='+a.listId+">"}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,t,a,o){return o.row+o.settings._iDisplayStart+1}},{targets:[7],className:"left",searchable:!0,orderable:!1,render:function(e,t,a){return null!=a.blockReason&&a.blockReason.length>blockReasonShowLength?getPartialContentHtml(a.blockReason,blockReasonShowLength):a.blockReason}},{targets:[10],className:"left",searchable:!0,orderable:!1,render:function(e,t,a){return null!=a.openReason&&a.openReason.length>openReasonShowLength?getPartialContentHtml(a.openReason,openReasonShowLength):a.openReason}}]}))}$(document).ready(function(){$("#btnPortOpen").click(function(e){doConfirmIpOpenByBtn()})});