var timer,startTime,timer_start,timer_end,startNum,pageLength,waitForNextData=!1,lastScrollYPos=0;function bindScrollEvent(){$(".dataTables_scrollBody").scroll(function(t){if(0==$(".dataTables_empty").length){var e=$("#resultTable > tBody > tr").length,a=$(this).prop("scrollTop"),l=$(this).prop("scrollHeight")-$(this).prop("clientHeight");a>lastScrollYPos&&(lastScrollYPos=a,e>=pageLength&&a>=l-100&&(waitForNextData||(waitForNextData=!0,findNextData())))}})}function unbindScrollEvent(){$(".dataTables_scrollBody").off("scroll")}function countDown(t){if("START"==t)startTime=parseInt(_timeout)-1,timer_start=performance.now(),timer=setInterval(function(){$("#timeoutMsg").val("Timeout倒數 : "+startTime+" 秒"),startTime--},1e3);else{timer_end=performance.now();var e=(parseInt(timer_end)-parseInt(timer_start))/1e3;$("#timeoutMsg").val("查詢花費時間 : "+e+" 秒"),clearInterval(timer)}}function addRow(t){for(var e=0;e<t.length;e++){var a=t[e],l=$("#resultTable > tBody > tr").length,r=$("#resultTable > tbody > tr:eq(0)").clone();$(r).find("td:eq(0)").html(++l),$(r).find("td:eq(1)").html(a.groupName),$(r).find("td:eq(2)").html(a.clientMac),$(r).find("td:eq(3)").html(a.startTime),$(r).find("td:eq(4)").html(a.endTime),$(r).find("td:eq(5)").html(a.userName),$(r).find("td:eq(6)").html(a.clientIp),$(r).find("td:eq(7)").html(a.apName),$(r).find("td:eq(8)").html(a.ssid),$(r).find("td:eq(9)").html(a.totalTraffic),$(r).find("td:eq(10)").html(a.uploadTraffic),$(r).find("td:eq(11)").html(a.downloadTraffic),$(r).find("td:eq(12)").html('<i class="fas fa-clipboard-list fa-2x" onclick="viewWifiDetail(\''+a.groupName+"','"+a.clientMac+"','"+a.clientIp+"','"+a.startTime+"','"+a.endTime+"')\" ></i>"),$("#resultTable > tbody").append($(r))}$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}function getTotalFilteredCount(){$.ajax({url:_ctx+"/plugin/module/wifiPoller/getTotalFilteredCount.json",data:{queryGroupId:$("#queryGroup").val(),queryDateBegin:$("#query_DateBegin").val(),queryDateEnd:$("#query_DateEnd").val(),queryTimeBegin:$("#query_TimeBegin").val(),queryTimeEnd:$("#query_TimeEnd").val(),queryClientMac:$("#query_ClientMac").val(),queryClientIp:$("#query_ClientIp").val(),queryApName:$("#query_ApName").val(),querySsid:$("#query_Ssid").val(),queryUserName:$("#query_UserName").val()},type:"POST",dataType:"json",async:!0,beforeSend:function(t){var e,a;0==$(".dataTables_empty").length?(e=1,a=$("#resultTable > tBody > tr").length):(e=0,a=0),$("#resultTable_info").html('<div class="row" style="padding-left: 15px;"><div id="current_count">顯示第 '+e+" 至 "+a+' 項結果，共</div><div id="total_count"><img id="searchWaiting2" class="img_searchWaiting" alt="loading..." src="/resources/images/Processing_4.gif"></div><div style="">筆</div></div>')},complete:function(){$("#searchWaiting2").hide()},initComplete:function(t,e){},success:function(t){var e=t.data.FILTERED_COUNT;$("#total_count").html("&nbsp;"+e+"&nbsp;")},error:function(t,e,a){$("#total_count").html("&nbsp;N/A&nbsp;")}})}function viewWifiDetail(t,e,a,l,r){var i=new Object;i.groupName=t,i.clientMac=e,i.clientIp=a,i.startTime=l,i.endTime=r,$.ajax({url:_ctx+"/plugin/module/wifiPoller/getWifiDetailData.json",data:JSON.stringify(i),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(t){if("200"==t.code){$("#viewWifiDetailModal_groupName").parent().show(),$("#viewWifiDetailModal_clientMac").parent().show(),$("#viewWifiDetailModal_clientIp").parent().show(),$("#viewWifiDetailModal_pollingTime").parent().show(),$("#viewWifiDetailModal_groupName").html(t.data.groupName),$("#viewWifiDetailModal_clientMac").html(t.data.clientMac),$("#viewWifiDetailModal_clientIp").html(t.data.clientIp),$("#viewWifiDetailModal_pollingTime").html(t.data.startTime+" ~ "+t.data.endTime);var e="<canvas id=\"canvasTraffic\" width=\"300\" height=\"100\"></canvas> \t\t\t\t<script> \t\t\t\tvar ctxTraffic = document.getElementById('canvasTraffic').getContext('2d'); \t\t\t\tvar colorTraffic = Chart.helpers.color; \t\t\t\tvar configTraffic = { \t\t\t\t\ttype: 'line', \t\t\t\t\tdata: { \t\t\t\t\t\tdatasets: [ \t\t\t\t\t\t    { \t\t\t\t\t\t\t\tlabel: 'Upload Traffic', \t\t\t\t\t\t\t\tborderColor: window.chartColors.red, \t\t\t\t\t\t\t\tfill: false, \t\t\t\t\t\t\t\tdata: "+t.data.uploadTrafficDataList+"}, { \t\t\t\t\t\t\t\tlabel: 'Download Traffic', \t\t\t\t\t\t\t\tborderColor: window.chartColors.blue, \t\t\t\t\t\t\t\tfill: false, \t\t\t\t\t\t\t\tdata: "+t.data.downloadTrafficDataList+"}, { \t\t\t\t\t\t\t\tlabel: 'Total Traffic', \t\t\t\t\t\t\t\tborderColor: window.chartColors.green, \t\t\t\t\t\t\t\tfill: false, \t\t\t\t\t\t\t\tdata: "+t.data.totalTrafficDataList+"} \t\t\t\t\t\t] \t\t\t\t\t}, \t\t\t\t\toptions: { \t\t\t\t\t\tresponsive: true, \t\t\t\t\t\ttitle: { \t\t\t\t\t\t\tdisplay: true, \t\t\t\t\t\t\ttext: \"Wifi Traffic Throughput Chart\" \t\t\t\t\t\t}, \t\t\t\t\t\tscales: { \t\t\t\t\t\t\txAxes: [{ \t\t\t\t\t\t\t\ttype: 'time', \t\t\t\t\t\t\t\tdisplay: true, \t\t\t\t\t\t\t\tscaleLabel: { \t\t\t\t\t\t\t\t\tdisplay: true, \t\t\t\t\t\t\t\t\tlabelString: 'Polling時間' \t\t\t\t\t\t\t\t}, \t\t\t\t\t\t\t\tticks: { \t\t\t\t\t\t\t\t\tmajor: { \t\t\t\t\t\t\t\t\t\tfontStyle: 'bold', \t\t\t\t\t\t\t\t\t\tfontColor: '#FF0000' \t\t\t\t\t\t\t\t\t} \t\t\t\t\t\t\t\t} \t\t\t\t\t\t\t}], \t\t\t\t\t\t\tyAxes: [{ \t\t\t\t\t\t\t\tdisplay: true, \t\t\t\t\t\t\t\tscaleLabel: { \t\t\t\t\t\t\t\t\tdisplay: true, \t\t\t\t\t\t\t\t\tlabelString: '流量(Octets)' \t\t\t\t\t\t\t\t} \t\t\t\t\t\t\t}] \t\t\t\t\t\t} \t\t\t\t\t} \t\t\t\t}; \t\t\t\tvar chartTraffic = new Chart(ctxTraffic, configTraffic); \t\t\t\t<\/script> \t\t\t\t";$("#viewWifiDetailModal_trafficData").html(e);var a="<canvas id=\"canvasQuality\" width=\"300\" height=\"100\"></canvas> \t\t\t\t\t<script> \t\t\t\t\tvar ctxQuality = document.getElementById('canvasQuality').getContext('2d'); \t\t\t\t\tvar colorQuality = Chart.helpers.color; \t\t\t\t\tvar configQuality = { \t\t\t\t\t\ttype: 'line', \t\t\t\t\t\tdata: { \t\t\t\t\t\t\tdatasets: [ \t\t\t\t\t\t\t    { \t\t\t\t\t\t\t\t\tlabel: 'SNR', \t\t\t\t\t\t\t\t\tborderColor: window.chartColors.red, \t\t\t\t\t\t\t\t\tfill: false, \t\t\t\t\t\t\t\t\tdata: "+t.data.snrDataList+"}, { \t\t\t\t\t\t\t\t\tlabel: 'Noise', \t\t\t\t\t\t\t\t\tborderColor: window.chartColors.blue, \t\t\t\t\t\t\t\t\tfill: false, \t\t\t\t\t\t\t\t\tdata: "+t.data.noiseDataList+"}, { \t\t\t\t\t\t\t\t\tlabel: 'RSSI', \t\t\t\t\t\t\t\t\tborderColor: window.chartColors.green, \t\t\t\t\t\t\t\t\tfill: false, \t\t\t\t\t\t\t\t\tdata: "+t.data.rssiDataList+"} \t\t\t\t\t\t\t] \t\t\t\t\t\t}, \t\t\t\t\t\toptions: { \t\t\t\t\t\t\tresponsive: true, \t\t\t\t\t\t\ttitle: { \t\t\t\t\t\t\t\tdisplay: true, \t\t\t\t\t\t\t\ttext: \"Wifi Signal Quality Chart\" \t\t\t\t\t\t\t}, \t\t\t\t\t\t\tscales: { \t\t\t\t\t\t\t\txAxes: [{ \t\t\t\t\t\t\t\t\ttype: 'time', \t\t\t\t\t\t\t\t\tdisplay: true, \t\t\t\t\t\t\t\t\tscaleLabel: { \t\t\t\t\t\t\t\t\t\tdisplay: true, \t\t\t\t\t\t\t\t\t\tlabelString: 'Polling時間' \t\t\t\t\t\t\t\t\t}, \t\t\t\t\t\t\t\t\tticks: { \t\t\t\t\t\t\t\t\t\tmajor: { \t\t\t\t\t\t\t\t\t\t\tfontStyle: 'bold', \t\t\t\t\t\t\t\t\t\t\tfontColor: '#FF0000' \t\t\t\t\t\t\t\t\t\t} \t\t\t\t\t\t\t\t\t} \t\t\t\t\t\t\t\t}], \t\t\t\t\t\t\t\tyAxes: [{ \t\t\t\t\t\t\t\t\tdisplay: true, \t\t\t\t\t\t\t\t\tscaleLabel: { \t\t\t\t\t\t\t\t\t\tdisplay: true, \t\t\t\t\t\t\t\t\t\tlabelString: '訊號品質' \t\t\t\t\t\t\t\t\t} \t\t\t\t\t\t\t\t}] \t\t\t\t\t\t\t} \t\t\t\t\t\t} \t\t\t\t\t}; \t\t\t\t\tvar chartQuality = new Chart(ctxQuality, configQuality); \t\t\t\t\t<\/script> \t\t\t\t\t";$("#viewWifiDetailModal_qualityData").html(a),$("#viewWifiDetailModal").modal("show")}else alert(t.message)},error:function(t,e,a){ajaxErrorHandler()}})}function findNextData(){var t,e=-1;$(".dataTable > thead").find(".sorting_asc").length>0?e=$(".dataTable > thead").find(".sorting_asc").prop("cellIndex"):$(".dataTable > thead").find(".sorting_desc").length>0&&(e=$(".dataTable > thead").find(".sorting_desc").prop("cellIndex")),t="descending"===$(".dataTable > thead > tr > th:eq("+e+")").attr("aria-sort")?"desc":"asc",$.ajax({url:_ctx+"/plugin/module/wifiPoller/getWifiMstData.json",data:{queryGroupId:$("#queryGroup").val(),queryDateBegin:$("#query_DateBegin").val(),queryDateEnd:$("#query_DateEnd").val(),queryTimeBegin:$("#query_TimeBegin").val(),queryTimeEnd:$("#query_TimeEnd").val(),queryClientMac:$("#query_ClientMac").val(),queryClientIp:$("#query_ClientIp").val(),queryApName:$("#query_ApName").val(),querySsid:$("#query_Ssid").val(),queryUserName:$("#query_UserName").val(),start:startNum,length:pageLength,"order[0][column]":e,"order[0][dir]":t},type:"POST",dataType:"json",async:!0,beforeSend:function(t){countDown("START"),showProcessing()},complete:function(){countDown("STOP"),hideProcessing(),waitForNextData=!1},initComplete:function(t,e){null!=e.msg&&($(".myTableSection").hide(),alert(e.msg))},success:function(t){var e,a,l=t.data.length;console.log("query success... count: "+l),l>0&&(addRow(t.data),startNum+=pageLength),0==$(".dataTables_empty").length?(e=1,a=$("#resultTable > tBody > tr").length):(e=0,a=0),$("#current_count").text("顯示第 "+e+" 至 "+a+" 項結果，共")},error:function(t,e,a){$("#current_count").text("<ERROR>"),ajaxErrorHandler()}})}function findData(t){var e,a,l,r,i,n;if($("#queryFrom").val(t),e=0!=$("#queryGroup").val().trim().length?"Y":"N",i=0!=$("#query_ClientIp").val().trim().length?"Y":"N",n=0!=$("#query_ClientMac").val().trim().length?"Y":"N",0!=$("#query_DateBegin").val().trim().length&&0!=$("#query_TimeBegin").val().trim().length)a="Y";else{if(0!=$("#query_DateBegin").val().trim().length||0!=$("#query_TimeBegin").val().trim().length)return void alert(msg_chooseDate);a="N"}if(0!=$("#query_DateEnd").val().trim().length&&0!=$("#query_TimeEnd").val().trim().length)l="Y";else{if(0!=$("#query_DateEnd").val().trim().length||0!=$("#query_TimeEnd").val().trim().length)return void alert(msg_chooseDate);l="N"}r="N"==a&&"N"==l?"N":"Y","N"!=e||"N"!=i||"N"!=n||"N"!=r?("MOBILE"==t&&$("#collapseExample").collapse("hide"),startNum=0,"undefined"!=typeof resultTable?($(".dataTables_scrollBody").scrollTop(0),resultTable.ajax.reload(),$(".myTableSection").show()):($(".myTableSection").show(),resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!1,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,pageLength:pageLength,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(t,e,a){},ajax:{url:_ctx+"/plugin/module/wifiPoller/getWifiMstData.json",type:"POST",data:function(t){return"WEB"==$("#queryFrom").val()?(t.queryGroupId=$("#queryGroup").val(),t.queryDateBegin=$("#query_DateBegin").val(),t.queryDateEnd=$("#query_DateEnd").val(),t.queryTimeBegin=$("#query_TimeBegin").val(),t.queryTimeEnd=$("#query_TimeEnd").val(),t.queryClientMac=$("#query_ClientMac").val(),t.queryClientIp=$("#query_ClientIp").val(),t.queryApName=$("#query_ApName").val(),t.querySsid=$("#query_Ssid").val(),t.queryUserName=$("#query_UserName").val()):"MOBILE"==$("#queryFrom").val()&&(t.queryDate=$("#query_Date_mobile").val(),t.queryClientMac=$("#query_ClientMac_mobile").val(),t.queryClientIp=$("#query_ClientIp_mobile").val(),t.queryApName=$("#query_ApName_mobile").val(),t.querySsid=$("#query_Ssid_mobile").val(),t.queryUserName=$("#query_UserName_mobile").val()),t.start=0,t.length=pageLength,t},beforeSend:function(){countDown("START")},complete:function(){countDown("STOP")},error:function(t,e,a){ajaxErrorHandler()},timeout:1e3*parseInt(_timeout)},order:[[3,"desc"]],initComplete:function(t,e){null!=e.msg&&($(".myTableSection").hide(),alert(e.msg)),bindScrollEvent()},drawCallback:function(t){$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),startNum=pageLength,lastScrollYPos=$(".dataTables_scrollBody").prop("scrollTop"),getTotalFilteredCount(),bindTrEvent()},columns:[{},{data:"groupName",orderable:!0},{data:"clientMac",orderable:!0},{data:"startTime",orderable:!0},{data:"endTime",orderable:!0},{data:"userName",orderable:!0},{data:"clientIp",orderable:!0},{data:"apName",orderable:!0},{data:"ssid",orderable:!0},{data:"totalTraffic",orderable:!0},{data:"uploadTraffic",orderable:!0},{data:"downloadTraffic",orderable:!0},{}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(t,e,a,l){return l.row+l.settings._iDisplayStart+1}},{targets:[12],className:"center",searchable:!1,orderable:!1,render:function(t,e,a){return'<i class="fas fa-clipboard-list fa-2x" onclick="viewWifiDetail(\''+a.groupName+"','"+a.clientMac+"','"+a.clientIp+"','"+a.startTime+"','"+a.endTime+"')\" ></i>"}}]}))):alert(msg_chooseOne)}$(document).ready(function(){initMenuStatus("toggleMenu_prtg","toggleMenu_prtg_items","cm_wifi"),startNum=0,pageLength=Number($("#pageLength").val());new Cleave(".input-port",{numericOnly:!0,blocks:[5]});$("#resultTable").on("xhr.dt",function(t,e,a,l){null!=a.msg&&($(".myTableSection").hide(),alert(a.msg))}),$("#query_ClientMac").unbind("blur").bind("blur",function(){$(this).val($(this).val().trim())}),$("#query_ClientIp").unbind("blur").bind("blur",function(){$(this).val($(this).val().trim())}),$("#query_ApName").unbind("blur").bind("blur",function(){$(this).val($(this).val().trim())}),$("#query_Ssid").unbind("blur").bind("blur",function(){$(this).val($(this).val().trim())}),$("#query_UserName").unbind("blur").bind("blur",function(){$(this).val($(this).val().trim())});var t=new Date,e=t.getFullYear(),a=parseInt(t.getMonth())+1;a=a<10?"0".concat(a):a;var l=t.getDate();l=l<10?"0".concat(l):l,$("#query_DateBegin").val(e+"-"+a+"-"+l),$("#query_DateEnd").val(e+"-"+a+"-"+l),$("#query_TimeBegin").val("00:00"),$("#query_TimeEnd").val("23:59")});