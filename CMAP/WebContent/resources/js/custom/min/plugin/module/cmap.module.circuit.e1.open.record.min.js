var resultTable_OpenRecord,blockedTableHeight,_navAndMenuAndFooterHeight=0,_deductHeight=0,pageLength=100;function findNextData(){var e,t=-1;$(".dataTable > thead").find(".sorting_asc").length>0?t=$(".dataTable > thead").find(".sorting_asc").prop("cellIndex"):$(".dataTable > thead").find(".sorting_desc").length>0&&(t=$(".dataTable > thead").find(".sorting_desc").prop("cellIndex")),e="descending"===$(".dataTable > thead > tr > th:eq("+t+")").attr("aria-sort")?"desc":"asc",$.ajax({url:_ctx+"/circuit/getE1OpenListData.json",data:{queryStatus:$("#queryStatus").val(),start:startNum,length:pageLength,"order[0][column]":t,"order[0][dir]":e},type:"POST",dataType:"json",async:!0,beforeSend:function(e){countDown("START"),showProcessing()},complete:function(){countDown("STOP"),hideProcessing(),waitForNextData=!1},initComplete:function(e,t){null!=t.msg&&($(".myTableSection").hide(),alert(t.msg))},success:function(e){var t,a,r=e.data.length;console.log("query success... count: "+r),r>0&&(addRow(e.data),startNum+=pageLength),0==$(".dataTables_empty").length?(t=1,a=$("#resultTable > tBody > tr").length):(t=0,a=0),$("#current_count").text("顯示第 "+t+" 至 "+a+" 項結果，共")},error:function(e,t,a){$("#current_count").text("<ERROR>"),ajaxErrorHandler()}})}function countDown(e){if("START"==e)startTime=parseInt(_timeout)-1,timer_start=performance.now(),timer=setInterval(function(){$("#timeoutMsg").val("Timeout倒數 : "+startTime+" 秒"),startTime--},1e3);else{timer_end=performance.now();var t=(parseInt(timer_end)-parseInt(timer_start))/1e3;$("#timeoutMsg").val("查詢花費時間 : "+t+" 秒"),clearInterval(timer)}}function bindScrollEvent(){$(".dataTables_scrollBody").scroll(function(e){if(0==$(".dataTables_empty").length){var t=$("#resultTable > tBody > tr").length,a=$(this).prop("scrollTop"),r=$(this).prop("scrollHeight")-$(this).prop("clientHeight");a>lastScrollYPos&&(lastScrollYPos=a,t>=pageLength&&a>=r-100&&(waitForNextData||(waitForNextData=!0,findNextData())))}})}function unbindScrollEvent(){$(".dataTables_scrollBody").off("scroll")}function findData(e){$("#queryFrom").val(e),"MOBILE"==e&&$("#collapseExample").collapse("hide"),startNum=0,"undefined"!=typeof resultTable?($(".dataTables_scrollBody").scrollTop(0),resultTable.ajax.reload(),$(".myTableSection").show()):($(".myTableSection").show(),resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!1,bFilter:!1,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,pageLength:pageLength,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,t,a){},ajax:{url:_ctx+"/circuit/getE1OpenListData.json",type:"POST",data:function(e){return e.start=0,e.length=pageLength,e},beforeSend:function(){countDown("START")},complete:function(){countDown("STOP")},error:function(e,t,a){ajaxErrorHandler()},timeout:1e3*parseInt(_timeout)},order:[[5,"desc"]],initComplete:function(e,t){null!=t.msg&&($(".myTableSection").hide(),alert(t.msg)),bindScrollEvent()},drawCallback:function(e){$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),startNum=pageLength,lastScrollYPos=$(".dataTables_scrollBody").prop("scrollTop"),$("#resultTable_filter").find("input").prop("placeholder","(模糊查詢速度較慢)"),bindTrEvent()},columns:[{},{data:"deviceId",className:"center",orderable:!1,visible:!1},{data:"circleName",className:"center",orderable:!1},{data:"stationName",className:"center",orderable:!1},{data:"stationEngName",className:"center",orderable:!1,visible:!1},{data:"neName",className:"center",orderable:!1},{data:"srcSid",className:"center",orderable:!1,visible:!1},{data:"dstSid",className:"center",orderable:!1,visible:!1},{data:"localCsrIp",className:"center",orderable:!1},{data:"remoteCsrIp",className:"center",orderable:!1},{data:"srcE1gwIp",className:"center",orderable:!1},{data:"dstE1gwIp",className:"center",orderable:!1},{data:"srcPortNumber",className:"center",orderable:!1},{data:"dstPortNumber",className:"center",orderable:!1},{data:"remark",className:"center",orderable:!1,visible:!1},{data:"updateTimeStr",className:"center",orderable:!1}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,t,a,r){return r.row+r.settings._iDisplayStart+1}}]}))}$(document).ready(function(){initMenuStatus("toggleMenu_plugin","toggleMenu_plugin_items","cm_circuitE1OpenRecord"),findData()});