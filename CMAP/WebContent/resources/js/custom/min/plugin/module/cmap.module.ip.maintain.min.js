function initActionBar(){$("#modifyActionBar").hide(),$("#defaultActionBar").show(),$(".dataTable").find("thead").eq(0).find("tr > th").css("pointer-events","auto"),$("select[name=resutTable_length]").removeAttr("disabled"),$("input[type=search]").removeAttr("disabled")}function toggleActionBar(){$("#modifyActionBar").toggle(),$("#defaultActionBar").toggle()}function showAddModal(){""!=$("#queryGroup").val()?($("#ipDataImportModal_dataSet").val(""),$("#div_edit_panel").show(),$("#btnIpDataImportNextStep").parent().show(),$("#confirm_panel_table > tbody > tr").remove(),$("#div_confirm_panel").hide(),$("#btnIpDataImportBackStep").parent().hide(),$("#btnIpDataImportConfirm").parent().hide(),$("#ipDataImportModal").modal({backdrop:"static"})):alert("請先選擇學校")}function showAddEditPanel(){$("#div_edit_panel").show(),$("#btnIpDataImportNextStep").parent().show(),$("#confirm_panel_table > tbody > tr").remove(),$("#div_confirm_panel").hide(),$("#btnIpDataImportBackStep").parent().hide(),$("#btnIpDataImportConfirm").parent().hide()}function transDoubleQuota(e){var t=e;return 0==t.indexOf('"')&&t.lastIndexOf('"')==t.length-1?t=(t=(t=t.replace(/\"\"/g,'"')).substring(1)).substring(0,t.length-1):0==t.indexOf('"')&&t.lastIndexOf('"')!=t.length-1?t=(t=t.replace(/\"\"/g,'"')).substring(1):0!=t.indexOf('"')&&t.lastIndexOf('"')==t.length-1&&(t=(t=t.replace(/\"\"/g,'"')).substring(0,t.length-1)),t}function showAddConfirmPanel(){var e=$("#ipDataImportModal_dataSet").val();if(null==e||""==e||null!=e&&0==e.length)alert("資料為空，請重新確認!");else{for(var t,a,n,i,r=$("#queryGroup option:selected").text(),o=e.split("\n"),l=0;l<o.length;l++){var d=(a=o[l]).indexOf(",");if(-1==d)return void alert("第 "+(l+1)+" 行格式錯誤! (未含逗點)");n=transDoubleQuota(a.substring(0,d).trim()),i=transDoubleQuota(a.substring(d+1,a.length).trim()),(t=$("<tr></tr>")).append($("<td></td>").text(l+1)),t.append($("<td></td>").text(r)),t.append($("<td></td>").text(n)),t.append($("<td></td>").text(i)),$("#confirm_panel_table > tbody").append(t)}$("#div_edit_panel").hide(),$("#btnClose").parent().hide(),$("#btnIpDataImportNextStep").parent().hide(),$("#div_confirm_panel").show(),$("#btnIpDataImportBackStep").parent().show(),$("#btnIpDataImportConfirm").parent().show()}}function changeModifyView(){var e=$("input[name=chkbox]:checked");if(0!=e.length){for(var t=0;t<e.length;t++){document.getElementsByTagName("body")[0].innerText;$("input[name=chkbox]:checked:eq("+t+")").attr("disabled","disabled"),$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(4).html(function(){return'<input type="text" name="modifyIpDesc" value="'+$(this).attr("content")+'" class="form-control form-control-sm" style="min-width: 200px" />'})}toggleActionBar(),$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$(".dataTable").find("thead").eq(0).find("tr > th").removeClass("sorting sorting_asc sorting_desc"),$(".dataTable").find("thead").eq(0).find("tr > th").css("pointer-events","none"),$("select[name=resutTable_length]").attr("disabled","disabled"),$("input[type=search]").attr("disabled","disabled"),$("li[id^=resutTable_]").addClass("disabled")}else alert("請先勾選欲修改的項目")}function envAction(e){var t=new Object;if("add"!=e){var a=$("input[name='chkbox']:checked").map(function(){return $(this).val()}).get();t.settingIds=a}if("update"==e){var n=$("input[name='modifyIpDesc']").map(function(){return $(this).val()}).get();t.modifyIpDesc=n}else if("delete"==e){if(0==$("input[name=chkbox]:checked").length)return void alert("請先勾選欲刪除的項目")}else if("add"==e){var i=$("#ipDataImportModal_dataSet").val();if(null==i||""==i||null!=i&&0==i.length)return void alert("資料為空，請重新確認!");t=new Object;for(var r=new Array,o=new Array,l=i.split("\n"),d=0;d<l.length;d++){dataLine=l[d];var s=dataLine.indexOf(",");if(-1==s)return void alert("第 "+(d+1)+" 行格式錯誤! (未含逗點)");ipAddr=transDoubleQuota(dataLine.substring(0,s).trim()),ipDesc=transDoubleQuota(dataLine.substring(s+1,dataLine.length).trim()),r.push(ipAddr),o.push(ipDesc)}t.groupId=$("#queryGroup").val(),t.modifyIpAddr=r,t.modifyIpDesc=o}$.ajax({url:_ctx+"/plugin/module/ipMaintain/"+e,data:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",dataType:"json",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?(alert(e.message),findData($("#queryFrom").val()),setTimeout(function(){$("#ipDataImportModal").modal("hide")},500)):alert(e.message)},error:function(e,t,a){ajaxErrorHandler()}})}function findData(e){$("#queryFrom").val(e),"MOBILE"==e&&$("#collapseExample").collapse("hide"),initActionBar(),$("#checkAll").prop("checked",!1),"undefined"!=typeof resultTable?(resultTable.ajax.reload(),$(".myTableSection").show()):($(".myTableSection").show(),resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,pageLength:100,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,t,a){$(e).children("td").eq(4).attr("content",t.ipDesc)},ajax:{url:_ctx+"/plugin/module/ipMaintain/getIpDataSetting.json",type:"POST",data:function(e){return"WEB"==$("#queryFrom").val()?e.queryGroup=$("#queryGroup").val():"MOBILE"==$("#queryFrom").val()&&(e.queryGroup=$("#queryGroup_mobile").val()),e},beforeSend:function(){},complete:function(){},error:function(e,t,a){ajaxErrorHandler()},timeout:1e3*parseInt(_timeout)},order:[[3,"desc"]],initComplete:function(e,t){null!=t.msg&&($(".myTableSection").hide(),alert(t.msg))},drawCallback:function(e){$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),bindTrEvent()},columns:[{},{},{data:"groupName",className:"center"},{data:"ipAddr",className:"center"},{data:"ipDesc"}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,t,a){return'<input type="checkbox" id="chkbox" name="chkbox" onclick="changeTrBgColor(this)" value='+a.settingId+">"}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,t,a,n){return n.row+n.settings._iDisplayStart+1}}]}))}$(document).ready(function(){initMenuStatus("toggleMenu_setting","toggleMenu_setting_items","st_ipMaintain"),$("#queryGroup").change(function(e){findData("WEB")}),$("#queryGroup_mobile").change(function(e){findData("MOBILE")}),$("#btnAdd").click(function(){showAddModal()}),$("#btnIpDataImportBackStep").click(function(){showAddEditPanel()}),$("#btnIpDataImportNextStep").click(function(){showAddConfirmPanel()}),$("#btnIpDataImportConfirm").click(function(){envAction("add")}),$("#btnModify").click(function(){changeModifyView()}),$("#btnDelete").click(function(){envAction("delete")}),$("#btnModifySubmit").click(function(){envAction("update")}),$("#btnModifyCancel").click(function(){findData($("#queryFrom").val())}),findData("WEB")});