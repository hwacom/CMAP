function initActionBar(){$("#modifyActionBar").hide(),$("#defaultActionBar").show(),$(".dataTable").find("thead").eq(0).find("tr > th").css("pointer-events","auto"),$("select[name=resutTable_length]").removeAttr("disabled"),$("input[type=search]").removeAttr("disabled")}function toggleActionBar(){$("#modifyActionBar").toggle(),$("#defaultActionBar").toggle()}function showAddModal(){""!=$("#queryGroup").val()?($("#ipDataImportModal_dataSet").val(""),$("#div_edit_panel").show(),$("#btnIpDataImportNextStep").parent().show(),$("#confirm_panel_table > tbody > tr").remove(),$("#div_confirm_panel").hide(),$("#btnIpDataImportBackStep").parent().hide(),$("#btnIpDataImportConfirm").parent().hide(),$("#ipDataImportModal").modal({backdrop:"static"})):alert(msg_chooseGroup)}function showAddEditPanel(){$("#div_edit_panel").show(),$("#btnIpDataImportNextStep").parent().show(),$("#confirm_panel_table > tbody > tr").remove(),$("#div_confirm_panel").hide(),$("#btnIpDataImportBackStep").parent().hide(),$("#btnIpDataImportConfirm").parent().hide()}function transDoubleQuota(e){var t=e;return 0==t.indexOf('"')&&t.lastIndexOf('"')==t.length-1?t=(t=(t=t.replace(/\"\"/g,'"')).substring(1)).substring(0,t.length-1):0==t.indexOf('"')&&t.lastIndexOf('"')!=t.length-1?t=(t=t.replace(/\"\"/g,'"')).substring(1):0!=t.indexOf('"')&&t.lastIndexOf('"')==t.length-1&&(t=(t=t.replace(/\"\"/g,'"')).substring(0,t.length-1)),t}function cleanConfirmPanelTable(){$("#confirm_panel_table > tbody > tr").remove()}function chkDataLineFormat(e,t,a){return-1==t?(alert("第 "+e+" 行格式錯誤!<br>錯誤原因: <font color='red'>未含逗點</font>"),!1):t!==a||(alert("第 "+e+" 行格式錯誤!<br>錯誤原因: <font color='red'>缺少欄位</font>"),!1)}function chkDataLineValue(e,t,a,n){if(""===t)return alert("第 "+e+" 行資料檢核失敗!<br>錯誤原因: <font color='red'>IP_Address必填</font>"),!1;if(""===n)return alert("第 "+e+" 行資料檢核失敗!<br>錯誤原因: <font color='red'>IP備註必填</font>"),!1;if(3!=(t.match(/\./g)||[]).length)return alert("第 "+e+" 行資料檢核失敗!<br>錯誤原因: <font color='red'>IP_Address格式錯誤</font>"),!1;for(var r=t.split("."),i=0;i<r.length;i++){var o=r[i];if(o<0||o>255)return alert("第 "+e+" 行資料檢核失敗!<br>錯誤原因: <font color='red'>IP_Address數值錯誤</font>"),!1}if(""!=a&&5!=(a.match(/:/g)||[]).length)return alert("第 "+e+" 行資料檢核失敗!<br>錯誤原因: <font color='red'>MAC_Address格式錯誤</font>"),!1;return!0}function getCommaIdx(e,t){var a;return"FIRST"===t?a=e.indexOf(","):"SECOND"===t?(a=e.indexOf(","))+1+e.substring(a+1,e.length).trim().indexOf(","):void 0}function showAddConfirmPanel(){var e=$("#ipDataImportModal_dataSet").val();if(null==e||""==e||null!=e&&0==e.length)alert("資料為空，請重新確認!");else{for(var t,a,n,r,i,o,d=$("#queryGroup option:selected").text(),l=e.split("\n"),c=0;c<l.length;c++){o=c+1;var s=getCommaIdx(a=l[c],"FIRST"),p=getCommaIdx(a,"SECOND");if(!chkDataLineFormat(o,s,p))return void cleanConfirmPanelTable();if(!chkDataLineValue(o,n=transDoubleQuota(a.substring(0,s).trim()),r=transDoubleQuota(a.substring(s+1,p).trim()),i=transDoubleQuota(a.substring(p+1,a.length).trim())))return void cleanConfirmPanelTable();(t=$("<tr></tr>")).append($("<td></td>").text(c+1)),t.append($("<td></td>").text(d)),t.append($("<td></td>").text(n)),t.append($("<td></td>").text(r)),t.append($("<td></td>").text(i)),$("#confirm_panel_table > tbody").append(t)}$("#div_edit_panel").hide(),$("#btnClose").parent().hide(),$("#btnIpDataImportNextStep").parent().hide(),$("#div_confirm_panel").show(),$("#btnIpDataImportBackStep").parent().show(),$("#btnIpDataImportConfirm").parent().show()}}function changeModifyView(){var e=$("input[name=chkbox]:checked");if(0!=e.length){for(var t=0;t<e.length;t++){document.getElementsByTagName("body")[0].innerText;$("input[name=chkbox]:checked:eq("+t+")").attr("disabled","disabled"),$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(4).html(function(){return'<input type="text" name="modifyMacAddr" value="'+$(this).attr("content")+'" class="form-control form-control-sm" style="min-width: 200px" />'}),$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(5).html(function(){return'<input type="text" name="modifyIpDesc" value="'+$(this).attr("content")+'" class="form-control form-control-sm" style="min-width: 200px" />'})}toggleActionBar(),$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$(".dataTable").find("thead").eq(0).find("tr > th").removeClass("sorting sorting_asc sorting_desc"),$(".dataTable").find("thead").eq(0).find("tr > th").css("pointer-events","none"),$("select[name=resutTable_length]").attr("disabled","disabled"),$("input[type=search]").attr("disabled","disabled"),$("li[id^=resutTable_]").addClass("disabled")}else alert("請先勾選欲修改的項目")}function envAction(e){var t=new Object;if("add"!=e){var a=$("input[name='chkbox']:checked").map(function(){return $(this).data("groupid")}).get(),n=$("input[name='chkbox']:checked").map(function(){return $(this).data("ipaddr")}).get();t.groupIds=a,t.ipAddrs=n}if("update"==e){var r=$("input[name='modifyMacAddr']").map(function(){return $(this).val()}).get(),i=$("input[name='modifyIpDesc']").map(function(){return $(this).val()}).get();t.modifyMacAddr=r,t.modifyIpDesc=i}else if("delete"==e){if(0==$("input[name=chkbox]:checked").length)return void alert("請先勾選欲刪除的項目")}else if("add"==e){var o=$("#ipDataImportModal_dataSet").val();if(null==o||""==o||null!=o&&0==o.length)return void alert("資料為空，請重新確認!");t=new Object;for(var d,l=new Array,c=new Array,s=new Array,p=o.split("\n"),u=0;u<p.length;u++){d=u+1,dataLine=p[u];var m=getCommaIdx(dataLine,"FIRST"),f=getCommaIdx(dataLine,"SECOND");if(!chkDataLineFormat(d,m,f))return void cleanConfirmPanelTable();if(ipAddr=transDoubleQuota(dataLine.substring(0,m).trim()),macAddr=transDoubleQuota(dataLine.substring(m+1,f).trim()),ipDesc=transDoubleQuota(dataLine.substring(f+1,dataLine.length).trim()),!chkDataLineValue(d,ipAddr,macAddr,ipDesc))return void cleanConfirmPanelTable();l.push(ipAddr),c.push(macAddr),s.push(ipDesc)}t.groupId=$("#queryGroup").val(),t.modifyIpAddr=l,t.modifyMacAddr=c,t.modifyIpDesc=s}$.ajax({url:_ctx+"/plugin/module/ipMaintain/"+e,data:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",dataType:"json",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?(alert(e.message),findData($("#queryFrom").val()),setTimeout(function(){$("#ipDataImportModal").modal("hide")},500)):alert(e.message)},error:function(e,t,a){ajaxErrorHandler()}})}function findData(e){$("#queryFrom").val(e),"MOBILE"==e&&$("#collapseExample").collapse("hide"),initActionBar(),$("#checkAll").prop("checked",!1),"undefined"!=typeof resultTable?(resultTable.ajax.reload(),$(".myTableSection").show()):($(".myTableSection").show(),resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,pageLength:100,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,t,a){$(e).children("td").eq(4).attr("content",htmlSpecialChars(t.macAddr)),$(e).children("td").eq(5).attr("content",htmlSpecialChars(t.ipDesc))},ajax:{url:_ctx+"/plugin/module/ipMaintain/getIpDataSetting.json",type:"POST",data:function(e){return"WEB"==$("#queryFrom").val()?e.queryGroup=$("#queryGroup").val():"MOBILE"==$("#queryFrom").val()&&(e.queryGroup=$("#queryGroup_mobile").val()),e},beforeSend:function(){},complete:function(){},error:function(e,t,a){ajaxErrorHandler()},timeout:1e3*parseInt(_timeout)},order:[[3,"desc"]],initComplete:function(e,t){null!=t.msg&&($(".myTableSection").hide(),alert(t.msg))},drawCallback:function(e){$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),bindTrEvent()},columns:[{},{},{data:"groupName",className:"center"},{data:"ipAddr",className:"center"},{data:"macAddr",className:"center"},{data:"ipDesc"}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,t,a){return'<input type="checkbox" id="chkbox" name="chkbox" onclick="changeTrBgColor(this)" value='+a.settingId+" data-groupId="+a.groupId+" data-ipAddr="+a.ipAddr+">"}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,t,a,n){return n.row+n.settings._iDisplayStart+1}}]}))}$(document).ready(function(){initMenuStatus("toggleMenu_setting","toggleMenu_setting_items","st_ipMaintain"),$("#queryGroup").change(function(e){findData("WEB")}),$("#queryGroup_mobile").change(function(e){findData("MOBILE")}),$("#btnAdd").click(function(){showAddModal()}),$("#btnIpDataImportBackStep").click(function(){showAddEditPanel()}),$("#btnIpDataImportNextStep").click(function(){showAddConfirmPanel()}),$("#btnIpDataImportConfirm").click(function(){envAction("add")}),$("#btnModify").click(function(){changeModifyView()}),$("#btnDelete").click(function(){envAction("delete")}),$("#btnModifySubmit").click(function(){envAction("update")}),$("#btnModifyCancel").click(function(){findData($("#queryFrom").val())}),findData("WEB")});